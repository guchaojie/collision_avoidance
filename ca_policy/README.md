# ca_policy

CA Policy is a ros package which arbitrates suitable policies according to the detected obstacle types. As inputs, the detected obstacle types are generated by camera based object detection and localization modules. CA Policy outputs policy name as topic *ca_policy* and acts the behaviors set to the given policy.

## Inputs
Intel ros\_object\_analytics is the default dependency package which provides the required topics. Actually, any component who produces such messages as below list can drive CA Policy module:
	- [object_analytics_msgs](https://github.com/intel/ros_object_analytics/tree/master/object_analytics_msgs)
	- [movidius_ncs_msgs] (https://github.com/intel/ros_intel_movidius_ncs/tree/devel/movidius_ncs_msgs)

See below for the detailed message definition
### Camera based object detection message
  * movidius_ncs_msgs/ObjectsInBoxes.msg:
  ```bash
       std_msgs/Header header
       ObjectInBox[] objects_vector
       float32 inference_time_ms
       float32 fps
  ```
  * movidius_ncs_msgs/ObjectInBoxe.msg:
  ```bash
       Object object
       sensor_msgs/RegionOfInterest roi
  ```
  * movidius_ncs_msgs/Object.msg:
  ```bash
       string object_name
       float32 probability
  ```

### Camera based object localization message
  * object\_analytics\_msgs/ObjectsInBoxes3D.msg:
  ```bash
       std_msgs/Header header
       ObjectInBox3D[] objects_in_boxes  # ObjectInBox3D array
  ```
  * object\_analytics\_msgs/ObjectInBox.msg:
  ```bash
       sensor_msgs/RegionOfInterest roi      # region of interest
       geometry_msgs/Point32 min             # min and max locate the diagonal of a bounding-box of the detected object whose
       geometry_msgs/Point32 max             # x, y and z axis parellel to the axises correspondingly in camera coordinates
  ```

### Camera based object tracking message
  * object\_analytics\_msgs/TrackedObjects.msg:
  ```bash
       std_msgs/Header header              # timestamp in header is the time the sensor captured the raw data
       TrackedObject[] tracked_objects     # TrackedObject array
  ```
  * object\_analytics\_msgs/TrackedObject.msg:
  ```bash
       int32 id                            # object identifier
       sensor_msgs/RegionOfInterest roi    # region of interest
  ```

## Outputs

CA Policy module publishes some messages to indicate different status/data.
 - **/vision\_object/merged\_object** merges info from the 3 input messages into one message.
 - **/vision\_object/social\_object** filters person objects from the merged objects, as well adds velocity info on demond.
 - **/ca\_policy/ca\_policy** notifies the current collision avoidance policy.

## Build and Runtime dependencies

  ROS packages from [ros-kinetic-desktop-full](http://wiki.ros.org/kinetic/Installation/Ubuntu)
  * roscpp
  * std_msgs
  * sensor_msgs
  * geometry_msgs
  * dynamic_reconfigure
  * message_filters

  ROS packages from [Intel repo](https://github.com/intel)
  * object\_analytics\_msgs
  * movidius\_ncs\_msgs

## Build Steps
  * to build
  ```bash
  cd ${ros_ws} # "ros_ws" is the catkin workspace root directory where this project is placed in
  catkin_make
  ```

  * to install
  ```bash
  catkin_make install
  ```

## Known issues

  * Velocity calculating is not considered in coordinates transformation. In the current version, calculating velocity under camera coordinates takes tolerance when robot moves.
  * some code should be changed for adding new policy. There is code optimization space for policy management.

## Security
> For security issues, please send mail to wei.zhi.liu@intel.com

